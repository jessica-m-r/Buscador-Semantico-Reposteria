<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Buscador de Reposter√≠a</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>Buscador de Reposter√≠a</h1>
        <form method="POST" class="search-container" id="searchForm">
            <input type="text" name="term" placeholder="Busca brownies, pasteles, chocolate..." value="{{ term }}">
            <button type="submit">üîç Buscar</button>
        </form>
    </div>

    <!-- Resultados Locales -->
    <div class="results-container">
        <h2>Resultados Locales</h2>
        {% if results_local %}
            <div class="results-grid">
                {% for item in results_local %}
                    <div class="card">
                        <div class="card-header">
                            <h3>{{ item.nombre }}</h3>
                        </div>

                        {% if item.clases %}
                        <div class="card-section">
                            <div class="section-title">Clasificaci√≥n</div>
                            <div class="tag-container">
                                {% for clase in item.clases %}
                                    <span class="tag">{{ clase }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.superclases %}
                        <div class="card-section">
                            <div class="section-title">Superclases</div>
                            <div class="tag-container">
                                {% for super in item.superclases %}
                                    <span class="tag">{{ super }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.es_producto %}
                            {% if item.ingredientes %}
                            <div class="card-section">
                                <div class="section-title">Ingredientes</div>
                                <ul>
                                    {% for ing in item.ingredientes %}
                                        <li>{{ ing }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            {% if item.herramientas %}
                            <div class="card-section">
                                <div class="section-title">Herramientas</div>
                                <ul>
                                    {% for h in item.herramientas %}
                                        <li>{{ h }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}

                            {% if item.tecnicas %}
                            <div class="card-section">
                                <div class="section-title">T√©cnicas</div>
                                <ul>
                                    {% for t in item.tecnicas %}
                                        <li>{{ t }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        {% endif %}

                        {% if item.atributos %}
                        <div class="card-section">
                            <div class="section-title">Atributos</div>
                            <div class="attributes-grid">
                                {% for key, values in item.atributos.items() %}
                                    <div class="attribute-item">
                                        <div class="attribute-key">{{ key }}</div>
                                        <div class="attribute-values">{{ values|join(', ') }}</div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.usada_en %}
                        <div class="card-section">
                            <div class="section-title">Usado en</div>
                            <div class="tag-container">
                                {% for uso in item.usada_en %}
                                    <span class="tag">{{ uso }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        {% if item.descripcion %}
                        <div class="card-section">
                            <div class="section-title">Descripci√≥n</div>
                            <p>{{ item.descripcion }}</p>
                        </div>
                        {% endif %}

                        {% if item.dbpedia_uri %}
                        <div class="card-section">
                            <a href="{{ item.dbpedia_uri }}" target="_blank">Ver en DBpedia</a>
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>üîç No se encontraron resultados locales</p>
        {% endif %}
    </div>

    <!-- Resultados DBpedia -->
    <div class="results-container">
        <h2>Resultados DBpedia</h2>
        <div id="dbpediaResults">
            <p>Cargando resultados en l√≠nea...</p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const term = "{{ term }}";
            if (term) {
                fetch(`/dbpedia_search?term=${encodeURIComponent(term)}`)
                    .then(res => res.json())
                    .then(data => {
                        const container = document.getElementById("dbpediaResults");
                        container.innerHTML = "";
                        if (data.length === 0) {
                            container.innerHTML = "<p>üîç No se encontraron resultados en DBpedia</p>";
                            return;
                        }
                        data.forEach(item => {
                            const card = document.createElement("div");
                            card.className = "card";

                            card.innerHTML = `
                                <div class="card-header">
                                    <h3>${item.nombre}</h3>
                                </div>
                                <div class="card-section">
                                    <div class="section-title">Descripci√≥n</div>
                                    <p>${item.descripcion}</p>
                                </div>
                                ${item.ingredientes.length ? `<div class="card-section">
                                    <div class="section-title">Ingredientes</div>
                                    <ul>${item.ingredientes.map(ing => `<li>${ing}</li>`).join('')}</ul>
                                </div>` : ""}
                                <div class="card-section">
                                    <a href="${item.dbpedia_uri}" target="_blank">Ver en DBpedia</a>
                                </div>
                            `;
                            container.appendChild(card);
                        });
                    });
            }
        });
    </script>
</body>
</html>
